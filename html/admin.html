<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin-Bereich</title>
    <link rel="stylesheet" href="../css/admin.css">
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
</head>

<body>
    <script src="../admin.js"></script>

    <!-- Admin Navigation -->
    <header class="admin-header">
        <h1>Admin-Bereich</h1>
    </header>
    <br><br><br><br><br>
    <div class="admin-container">
        <!-- Eventmanagement -->
        <section class="admin-section">
            <h2>Eventmanagement</h2>
            <button id="openEventModal">Event anlegen</button>
            <div id="eventModal" class="modal hidden">
                <div class="modal-content">
                    <h3>Neues Event anlegen</h3>
                    <label>Datum:</label> <input id="Eventdatum" type="date">
                    <label>Uhrzeit:</label> <input id="Eventuhrzeit" type="time">
                    <label>Name:</label> <input id="Eventname" type="text">
                    <label>Beschreibung:</label> <textarea id="Eventbeschreibung"></textarea>
                    <label><input type="checkbox" id="Eventeintragung"> Eintragung durch Nutzer möglich</label>
                    <button onclick="eventanlage()" id="saveEvent">Speichern</button>
                    <button id="closeEventModal">Schließen</button>
                </div>
            </div>
        </section>

        <!-- Mitgliederverwaltung -->
        <section class="admin-section">
            <h2>Mitgliederverwaltung</h2>
            <button id="loadMembers">Mitglieder anzeigen</button>
            <div id="membersPopup" class="modal hidden">
                <div class="modal-content">
                    <h3>Mitgliederliste</h3>
                    <ul id="memberListPopup"></ul>
                    <button id="closeMembersPopup">Schließen</button>
                </div>
            </div>
        </section>

        <!-- Turniere -->
        <section class="admin-section">
            <h2>Turnierverwaltung</h2>
            <button id="openTournamentModal">Turnier erstellen</button>
            <div id="tournamentModal" class="modal hidden">
                <div class="modal-content">
                    <h3>Neues Turnier erstellen</h3>
                    <label>Name:</label> <input type="text">
                    <label>Startdatum:</label> <input type="date">
                    <label>Startzeit:</label> <input type="time">
                    <label>Ort:</label> <input type="text">
                    <label>Turnierart:</label> <input type="text">
                    <button id="saveTournament">Speichern</button>
                    <button id="closeTournamentModal">Schließen</button>
                </div>
            </div>
        </section>

        <!-- Nachrichtenverwaltung -->
        <section id="chat" class="admin-section">
            <h2>Chat-Nachrichten</h2>
            <button id="loadMessages">Nachrichten laden</button>
            <div id="messagesPopup" class="modal hidden">
                <div class="modal-content">
                    <h3>Nachrichten</h3>
                    <ul id="messageListPopup"></ul>
                    <button id="closeMessagesPopup">Schließen</button>
                </div>
            </div>
        </section>

        <!-- Spielplan -->
        <section class="admin-section">
            <h2>Spielplan</h2>
            <button id="openSpielplanModal">Spielplan bearbeiten</button>
            <div id="spielplanModal" class="modal hidden">
                <div class="modal-content">
                    <h3>Spielplan-Link eingeben</h3>
                    <label>Link:</label> <input type="url">
                    <button id="saveSpielplan">Speichern</button>
                    <button id="closeSpielplanModal">Schließen</button>
                </div>
            </div>
        </section>

        <!-- Platzreservierung -->
        <section class="admin-section">
            <h2>Platzsperrung</h2>
            <button id="openPlatzModal">Platz reservieren</button>
            <div id="platzModal" class="modal hidden">
                <div class="modal-content">
                    <h3>Platz sperren</h3>
                    <label>Uhrzeit:</label> <input id="platz-time" type="time">
                    <label>Datum:</label> <input id="platz-date" type="date">
                    <label>Plazt</label> <select id="platz-platz">
                        <option value="Platz 1">Platz 1</option>
                        <option value="Platz 2">Platz 2</option>
                        <option value="Platz 3">Platz 3</option>
                        <option value="Platz 4">Platz 4</option>
                        <option value="Platz 5">Platz 5</option>
                        <option value="Platz 6">Platz 6</option>
                    </select> <br>
                    <label>Name:</label> <input id="platz-name" type="text">
                    <button onclick="addadminReservation()" id="savePlatz">Speichern</button>
                    <button id="closePlatzModal">Schließen</button>
                </div>
            </div>
        </section>
    </div>
    <br><br><br><br><br><br>

    <!-- Menü-Button für kleine Bildschirme -->
    <div id="menu-button">
        <span class="material-symbols-outlined">menu</span>
    </div>

    <!-- Dropdown-Menü für kleine Bildschirme -->
    <div id="menu-dropdown" class="hidden">
        <div id="Admin"><span class="material-symbols-outlined">admin_panel_settings</span><span>Admin</span></div>
        <div id="Spielplan"><span class="material-symbols-outlined">calendar_month</span><span>Spielplan</span></div>
        <div id="Tunire"><span class="material-symbols-outlined">emoji_events</span><span>Turniere</span></div>
        <div id="Home"><span class="material-symbols-outlined">home</span><span>Home</span></div>
        <div id="Chat"><span class="material-symbols-outlined">chat</span><span>Chat</span></div>
        <div id="platzreservierung"><span class="material-symbols-outlined">event_seat</span><span>Platz</span></div>
        <div id="Sonstiges"><span class="material-symbols-outlined">more_horiz</span><span>Sonstiges</span></div>
    </div>

    <!-- Normale Toolbar -->
    <div id="toolbar">
        <div id="Admin"><span class="material-symbols-outlined">admin_panel_settings</span><span>Admin</span></div>
        <div id="Spielplan"><span class="material-symbols-outlined">calendar_month</span><span>Spielplan</span></div>
        <div id="Tunire"><span class="material-symbols-outlined">emoji_events</span><span>Turniere</span></div>
        <div id="Home"><span class="material-symbols-outlined">home</span><span>Home</span></div>
        <div id="Chat"><span class="material-symbols-outlined">chat</span><span>Chat</span></div>
        <div id="platzreservierung"><span class="material-symbols-outlined">event_seat</span><span>Platz</span></div>
        <div id="Sonstiges"><span class="material-symbols-outlined">more_horiz</span><span>Sonstiges</span></div>
    </div>

    <script>
        // Popups steuern
        document.getElementById("openEventModal").addEventListener("click", function () {
            document.getElementById("eventModal").classList.remove("hidden");
        });
        document.getElementById("closeEventModal").addEventListener("click", function () {
            document.getElementById("eventModal").classList.add("hidden");
        });

        document.getElementById("openTournamentModal").addEventListener("click", function () {
            document.getElementById("tournamentModal").classList.remove("hidden");
        });
        document.getElementById("closeTournamentModal").addEventListener("click", function () {
            document.getElementById("tournamentModal").classList.add("hidden");
        });

        document.getElementById("openSpielplanModal").addEventListener("click", function () {
            document.getElementById("spielplanModal").classList.remove("hidden");
        });
        document.getElementById("closeSpielplanModal").addEventListener("click", function () {
            document.getElementById("spielplanModal").classList.add("hidden");
        });

        document.getElementById("openPlatzModal").addEventListener("click", function () {
            document.getElementById("platzModal").classList.remove("hidden");
        });
        document.getElementById("closePlatzModal").addEventListener("click", function () {
            document.getElementById("platzModal").classList.add("hidden");
        });

        // Mitglieder anzeigen
        document.getElementById("loadMembers").addEventListener("click", function () {
            const members = ['Max Mustermann', 'Erika Mustermann', 'John Doe'];  // Beispiel-Mitglieder
            const memberListPopup = document.getElementById("memberListPopup");
            memberListPopup.innerHTML = '';
            members.forEach(member => {
                const li = document.createElement('li');
                li.innerHTML = `${member} <button class="deleteMember">Löschen</button>`;
                memberListPopup.appendChild(li);
            });

            document.getElementById("membersPopup").classList.remove("hidden");

            // Löschen eines Mitglieds
            const deleteButtons = document.querySelectorAll('.deleteMember');
            deleteButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const li = button.parentElement;
                    li.remove();
                });
            });
        });

        document.getElementById("closeMembersPopup").addEventListener("click", function () {
            document.getElementById("membersPopup").classList.add("hidden");
        });

        // Nachrichten anzeigen


        document.getElementById("closeMessagesPopup").addEventListener("click", function () {
            document.getElementById("messagesPopup").classList.add("hidden");
        });
    </script>

    <script>

        // Beispielaufruf der Funktion, um die Rolle zu überprüfen und zu aktualisieren



        // JavaScript für das Menü
        document.getElementById("menu-button").addEventListener("click", function () {
            document.getElementById("menu-dropdown").classList.toggle("hidden");
        });


        document.addEventListener("DOMContentLoaded", function () {
            function handleNavigation(event) {
                const targetId = event.target.closest("div")?.id;
                const links = {
                    "Admin": "admin.html",
                    "Spielplan": "spielplan.html",
                    "Tunire": "turniere.html",
                    "Home": "../index.html",
                    "Chat": "chat.html",
                    "platzreservierung": "platzreservierung.html",
                    "Sonstiges": "sonstiges.html"
                };
                if (links[targetId]) {
                    window.location.href = links[targetId];
                }
            }

            document.getElementById("toolbar").addEventListener("click", handleNavigation);
            document.getElementById("menu-dropdown").addEventListener("click", handleNavigation);
        });





        document.addEventListener("DOMContentLoaded", function () {
            // Prüfen, ob der Code bereits in der Session gespeichert ist

            // Daten aus dem Local Storage abrufen
            const storedEmail = localStorage.getItem("Email");
            const storedPassword = localStorage.getItem("Passwort"); // Falls "Angemeldet bleiben" aktiviert wurde
            const storedRole = localStorage.getItem("Rolle");


            // Falls keine Daten vorhanden sind, zur Anmeldung weiterleiten
            if (!storedEmail || !storedPassword) {
                console.log("Keine gespeicherten Anmeldeinformationen gefunden.");
                window.location.href = "../anmeldung/anmeldung.html";
                return;
            }

            // Server-Anfrage zur Überprüfung der Anmeldedaten
            fetch("../anmeldung/anmeldung.php", {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded",
                },
                body: new URLSearchParams({
                    action: "auto",
                    email: storedEmail,
                    password: storedPassword || "",
                }),
            })
                .then(response => response.text())  // Hier auf .text() ändern
                .then(text => {
                    console.log("Server-Antwort:", text);  // Debugging-Ausgabe

                    let data;
                    try {
                        data = JSON.parse(text);  // Versuchen, die Antwort zu parsen
                    } catch (e) {
                        console.error("Fehler beim Parsen der Antwort:", e); // Fehlerausgabe
                        alert("Fehler beim Parsen der Antwort: " + e);
                        return;
                    }

                    if (data.status === "success") {
                        console.log("Benutzer erfolgreich authentifiziert.");
                        sessionStorage.setItem("authCode", "verified");

                        // Hier wird geprüft, ob die Rolle vorhanden ist oder null
                        if (data.rolle !== null) {
                            console.log("Rolle des Benutzers:", data.rolle);
                        } else {
                            console.log("Keine Rolle zugewiesen (Wert ist null).");
                            window.location.href = "../anmeldung/anmeldung.html";
                        }
                    } else {
                        console.log("Ungültige Anmeldeinformationen, Weiterleitung zur Anmeldung.");
                        localStorage.clear();
                        window.location.href = "../anmeldung/anmeldung.html";
                    }
                })
                .catch(error => {
                    console.error("Fehler bei der Authentifizierung:", error);
                    window.location.href = "../anmeldung/anmeldung.html";
                });
        });

    </script>

</body>

</html>